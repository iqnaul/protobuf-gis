language: node_js

env:

matrix:
  include:
    - node_js: node
      env:
        - TEST_NODE=1
        - TEST_PYTHON=0
    - python: 2.7
      env:
        - TEST_NODE=0
        - TEST_PYTHON=1
    - python: 3.4
      env:
        - TEST_NODE=0
        - TEST_PYTHON=1
    - python: 3.5
      env:
        - TEST_NODE=0
        - TEST_PYTHON=1
    - python: 3.6
      env:
        - TEST_NODE=0
        - TEST_PYTHON=1

before_install:
  - curl -OL https://github.com/google/protobuf/releases/download/v3.2.0/protoc-3.2.0-linux-x86_64.zip
  - unzip protoc-3.2.0-linux-x86_64.zip -d protoc3
  - sudo mv protoc3/bin/* /usr/local/bin/
  - sudo mv protoc3/include/* /usr/local/include/
  - if [ $TEST_NODE == 1 ]; then cd js; npm run prepare; fi
  - if [ $TEST_PYTHON == 1 ]; then cd python; fi

install:
  - if [ $TEST_NODE == 1 ]; then npm install; fi
  - if [ $TEST_PYTHON == 1 ]; then pip install protobuf==3.3.0; fi

script:
  - if [ $TEST_NODE == 1 ]; then npm test; fi
  - if [ $TEST_PYTHON == 1 ]; then python setup.py test; fi
